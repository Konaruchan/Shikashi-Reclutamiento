<script>
    document.addEventListener('DOMContentLoaded', () => {
        console.log('DOMContentLoaded disparado. Iniciando inicialización de la página...');

        const featuredArticlesContainer = document.getElementById('featured-articles-container');
        const carouselContainer = document.getElementById('carousel-container');
        const prevButton = document.getElementById('prevButton');
        const nextButton = document.getElementById('nextButton');

        let currentPage = 0;
        const articlesPerPage = 5;

        function displayFeaturedArticles(articles) {
            console.log('Mostrando artículos destacados...');
            featuredArticlesContainer.innerHTML = '';
            const featuredArticles = articles.filter(article => article.featured);

            // Repetir artículos si hay menos de 5 destacados
            while (featuredArticles.length < 5) {
                featuredArticles.push(...articles);
            }

            featuredArticles.slice(0, 5).forEach(article => {
                console.log('Procesando artículo destacado:', article.title);
                const articleElement = document.createElement('div');
                articleElement.className = 'article-item';

                articleElement.innerHTML = `
                    <img src="${article.thumbnail}" alt="${article.title}" class="article-thumbnail">
                    <h2>${article.title}</h2>
                    <p class="article-subtitle">${article.subtitle}</p>
                    <p class="article-date-author">Publicado el ${article.date} por ${article.author}</p>
                    <a href="articulo.html?id=${article.id}" class="read-more">Leer Más</a>
                `;

                featuredArticlesContainer.appendChild(articleElement);
            });
        }

        function displayCarouselArticles(articles) {
            console.log('Mostrando carrusel de artículos...');
            carouselContainer.innerHTML = '';

            // Ordenar artículos: featured, new, fecha
            articles.sort((a, b) => {
                if (a.featured && !b.featured) return -1;
                if (!a.featured && b.featured) return 1;
                if (a.new && !b.new) return -1;
                if (!a.new && b.new) return 1;
                return new Date(b.date) - new Date(a.date);
            });

            // Repetir artículos si hay menos de 15
            while (articles.length < 15) {
                articles.push(...articles);
            }

            const pages = [];
            for (let i = 0; i < articles.length; i += articlesPerPage) {
                const page = articles.slice(i, i + articlesPerPage);
                const pageContainer = document.createElement('div');
                pageContainer.className = 'carousel-page';

                page.forEach(article => {
                    console.log('Procesando artículo del carrusel:', article.title);
                    const articleElement = document.createElement('div');
                    articleElement.className = 'article-item';

                    articleElement.innerHTML = `
                        <img src="${article.thumbnail}" alt="${article.title}" class="article-thumbnail">
                        <h2>${article.title}</h2>
                        <p class="article-subtitle">${article.subtitle}</p>
                        <p class="article-date-author">Publicado el ${article.date} por ${article.author}</p>
                        <a href="articulo.html?id=${article.id}" class="read-more">Leer Más</a>
                    `;

                    pageContainer.appendChild(articleElement);
                });

                pages.push(pageContainer);
            }

            pages.forEach((page, index) => {
                carouselContainer.appendChild(page);
                if (index === 0) {
                    page.classList.add('active');
                }
            });

            // Manejo de botones de carrusel
            prevButton.addEventListener('click', () => {
                currentPage = (currentPage > 0) ? currentPage - 1 : pages.length - 1;
                showPage(currentPage);
            });

            nextButton.addEventListener('click', () => {
                currentPage = (currentPage < pages.length - 1) ? currentPage + 1 : 0;
                showPage(currentPage);
            });
        }

        function showPage(pageIndex) {
            console.log('Cambiando página del carrusel a:', pageIndex);
            const pages = carouselContainer.querySelectorAll('.carousel-page');
            pages.forEach((page, index) => {
                page.style.display = index === pageIndex ? 'flex' : 'none';
            });
        }

        function displayArticles() {
            console.log('Intentando mostrar artículos...');
            if (window.articlesData) {
                console.log('Artículos encontrados en window.articlesData:', window.articlesData);
                displayFeaturedArticles(window.articlesData);
                displayCarouselArticles(window.articlesData);
            } else {
                console.log('Artículos no disponibles todavía. Reintentando en 100ms...');
                setTimeout(displayArticles, 100); // Esperar hasta que se carguen los artículos
            }
        }

        // Inicializar la carga de artículos
        console.log('Inicializando displayArticles...');
        displayArticles();
    });
</script>
